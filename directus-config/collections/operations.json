[
  {
    "name": "Kondition",
    "key": "condition_k2lb6",
    "type": "condition",
    "position_x": 3,
    "position_y": 51,
    "options": {
      "filter": {
        "$trigger": {
          "payload": {
            "shifts_status": {
              "_or": [
                {
                  "_eq": "requested"
                },
                {
                  "_null": true
                }
              ]
            }
          }
        }
      }
    },
    "resolve": null,
    "reject": null,
    "flow": "610aa314-bd89-461e-b8a0-10d0ad75f2d4",
    "_syncId": "9f05fe37-fb6e-48c8-abad-59b205972a9c"
  },
  {
    "name": "createCampaign",
    "key": "createCampaign",
    "type": "item-create",
    "position_x": 22,
    "position_y": 19,
    "options": {
      "collection": "messages_campaigns",
      "permissions": "$full",
      "emitEvents": true,
      "payload": {
        "messages_recipients": "{{prepareRecipients.recipients}}",
        "messages_template": "{{$trigger.body.template.key}}"
      }
    },
    "resolve": null,
    "reject": null,
    "flow": "9ee2e72d-ca7e-4c4b-ab18-97abfd062ddf",
    "_syncId": "48b43cec-c342-4689-be63-9d60311d5d95"
  },
  {
    "name": "createInvoiceEntries",
    "key": "createInvoiceEntries",
    "type": "item-create",
    "position_x": 25,
    "position_y": 38,
    "options": {
      "collection": "payments_invoices_entries",
      "permissions": "$full",
      "payload": {
        "payments_invoice": "{{createInvoice[0]}}",
        "payments_description": "MILA Genossenschaftsanteil",
        "payments_quantity": "{{calcShares.sharesToBeInvoiced}}",
        "payments_price": "2000"
      }
    },
    "resolve": null,
    "reject": null,
    "flow": "f714c75a-e78a-4c80-9b4d-4b39943d6444",
    "_syncId": "9f3db152-9448-4751-b187-f12ea93b543a"
  },
  {
    "name": "endNoBlock",
    "key": "end_no_block",
    "type": "exec",
    "position_x": 14,
    "position_y": 27,
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn {\n    \t\"nothing\":\"nothing\"\n    };\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "093c3c49-f5f8-41e0-bc77-7a6ec9fe7a80",
    "_syncId": "d8876f06-ea68-4be5-aee8-d4ef6b57404f"
  },
  {
    "name": "Skript ausführen",
    "key": "exec_1p2yn",
    "type": "exec",
    "position_x": 37,
    "position_y": 17,
    "options": {
      "code": "module.exports = async function(data) {\n\t// Do something...\n\treturn {\n    \t\"true\": true\n    };\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "5719873c-0ef4-45e4-90e4-80b8b30ea4d1",
    "_syncId": "c5485f09-f7da-4912-a005-c505ea996de6"
  },
  {
    "name": "Skript ausführen",
    "key": "exec_bweoq",
    "type": "exec",
    "position_x": 5,
    "position_y": 41,
    "options": {
      "code": "module.exports = async function(data) {\n\treturn {\n    \ttest: 1\n    };\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "c36a2159-395e-4eec-acb7-86cbd1d81d5c",
    "_syncId": "bae6bd2e-a01d-430a-9982-98ba944cb7be"
  },
  {
    "name": "Skript ausführen",
    "key": "exec_xtr5y",
    "type": "exec",
    "position_x": 23,
    "position_y": 20,
    "options": {
      "code": "module.exports = async function(data) {\n\t\n    const user_ids = []\n    let id = undefined\n    \n    for (i in data[\"read_assignments\"]) {\n    \tid = data[\"read_assignments\"][i].read_assignments.memberships_user\n        if (id) {\n            user_ids.push(id)\n        }\n    }\n    \n\treturn { user_ids };\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "4132f37d-df4d-4d17-ae4f-f048b8a74af5",
    "_syncId": "1f512365-ff4e-4e6c-bb20-0412e886ba0a"
  },
  {
    "name": "Daten aktualisieren",
    "key": "item_update_jta0y",
    "type": "item-update",
    "position_x": 24,
    "position_y": 21,
    "options": {
      "permissions": "$full",
      "collection": "memberships",
      "payload": {
        "shifts_counter": "{{ $last.updated_points }}"
      },
      "key": [
        "{{ $trigger.shifts_membership }}"
      ]
    },
    "resolve": null,
    "reject": null,
    "flow": "55cc41e8-4d68-4895-b42e-e5af00a316f4",
    "_syncId": "3882cc7c-d9cb-4d6c-8ce5-2f431773d3c4"
  },
  {
    "name": "Daten aktualisieren",
    "key": "item_update_rwk16",
    "type": "item-update",
    "position_x": 10,
    "position_y": 24,
    "options": {
      "collection": "memberships",
      "permissions": "$full",
      "payload": {
        "memberships_user_search": "{{$last.first_name}} {{$last.last_name}} {{$last.email}}"
      },
      "query": null,
      "key": "{{$last.memberships[0].id}}"
    },
    "resolve": null,
    "reject": null,
    "flow": "e67933a7-f0df-41e2-b905-d49a8f2482db",
    "_syncId": "f3c9decb-96dd-41be-8e8d-13b9e0036999"
  },
  {
    "name": "Daten aktualisieren",
    "key": "item_update_u6ufd",
    "type": "item-update",
    "position_x": 22,
    "position_y": 20,
    "options": {
      "collection": "memberships",
      "key": [
        "{{ $trigger.shifts_membership }}"
      ],
      "payload": {
        "shifts_counter": "{{ $last.updated_points }}"
      }
    },
    "resolve": null,
    "reject": null,
    "flow": "6179bf54-3ad8-4def-834d-b0cccf33c0dc",
    "_syncId": "ac97085b-079f-43cd-bc12-4642854c3e40"
  },
  {
    "name": "Daten aktualisieren",
    "key": "item_update_v6mlv",
    "type": "item-update",
    "position_x": 21,
    "position_y": 21,
    "options": {
      "collection": "memberships",
      "permissions": "$full",
      "key": [
        "{{ $trigger.payload.shifts_membership }}"
      ],
      "payload": {
        "shifts_counter": "{{ $last.updated_points }}"
      }
    },
    "resolve": null,
    "reject": null,
    "flow": "1cea747f-3aeb-43c2-a4b8-63d269d7774a",
    "_syncId": "34c335fa-db33-4388-a1ea-f926b5e51625"
  },
  {
    "name": "postToNuxtAPI",
    "key": "post_to_nuxt_api",
    "type": "request",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "url": "{{$env.COLLECTIVO_API_URL}}/api/user_create",
      "method": "POST",
      "body": "{{$trigger}}",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ]
    },
    "resolve": null,
    "reject": null,
    "flow": "5ea28856-7cb2-49a4-86b8-eacbd27ac54d",
    "_syncId": "ad799be4-d215-4375-97d7-6308e05f46f4"
  },
  {
    "name": "postToNuxtAPI",
    "key": "post_to_nuxt_api",
    "type": "request",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/user_sync_keycloak",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{{$trigger}}"
    },
    "resolve": null,
    "reject": null,
    "flow": "5719873c-0ef4-45e4-90e4-80b8b30ea4d1",
    "_syncId": "0c188aa8-7df4-4fea-bd78-23758e8a9013"
  },
  {
    "name": "postToNuxtAPI",
    "key": "postToNuxtAPI",
    "type": "request",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/cronjobs",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": null
    },
    "resolve": null,
    "reject": null,
    "flow": "8fbda46c-8ed1-4578-a38a-5ddbd11ee4da",
    "_syncId": "9e5efeae-a13a-4841-9653-b4efb31192c8"
  },
  {
    "name": "prepareRecipients",
    "key": "prepareRecipients",
    "type": "exec",
    "position_x": 5,
    "position_y": 19,
    "options": {
      "code": "module.exports = async function(data) {\n\tconst recipients = []\n    for (i in data[\"readMemberships\"]) {\n \trecipients.push(\n            {\n                messages_campaigns_id: \"+\",\n           \t\tdirectus_users_id: { id: data[\"readMemberships\"][i].memberships_user }\n            }\n        )\n    }\n\treturn { recipients };\n}"
    },
    "resolve": "48b43cec-c342-4689-be63-9d60311d5d95",
    "reject": null,
    "flow": "9ee2e72d-ca7e-4c4b-ab18-97abfd062ddf",
    "_syncId": "c6b1bdc0-86e7-4523-908b-d00c06bc84b7"
  },
  {
    "name": "readMemberships",
    "key": "readMemberships",
    "type": "item-read",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "collection": "memberships",
      "query": {
        "fields": [
          "memberships_user"
        ],
        "filter": {
          "id": {
            "_in": "{{$trigger.body.keys}}"
          }
        }
      }
    },
    "resolve": "c6b1bdc0-86e7-4523-908b-d00c06bc84b7",
    "reject": null,
    "flow": "9ee2e72d-ca7e-4c4b-ab18-97abfd062ddf",
    "_syncId": "bf786ac0-4a7b-49c3-9084-9ff1129d6e79"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_1jo36",
    "type": "request",
    "position_x": 10,
    "position_y": 40,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/campaign",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{\n    \"automation_name\": \"sortiment_update\",\n    \"wunsch_name\": \"{{read_elements[0].name}}\",\n    \"wunsch_id\": {{read_elements[0].id}},\n    \"user_ids\": {{user_ids.user_ids}}\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "c97d8437-3ee4-49d3-9e95-a1b0b147b9b7",
    "_syncId": "a9c23e19-5e10-4ad6-90fd-4744f3b2fbb1"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_6ayym",
    "type": "request",
    "position_x": 5,
    "position_y": 38,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/campaign",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{\n\t    \"user_ids\": [\"{{read_user.memberships_user.id}}\"],    \n    \"automation_name\": {{get_automations.automations1}}\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "9231dda9-725b-4104-a466-6d8bc1589c22",
    "_syncId": "68785ced-3a6b-4ea9-a156-0e6a9f57550e"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_asgww",
    "type": "request",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "body": "{{$last}}",
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/lotzapp_sync",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ]
    },
    "resolve": null,
    "reject": null,
    "flow": "939f6a73-ceb3-4974-b4b2-65649be03c84",
    "_syncId": "fbde7649-db9a-4d65-91be-973088dcde40"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_cls83",
    "type": "request",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/campaigns_send",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{{$trigger}}"
    },
    "resolve": null,
    "reject": null,
    "flow": "24887665-6c92-44f5-b0ef-8fce13f01df2",
    "_syncId": "686e608a-82b1-4116-8946-5b904e8f3c86"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_cvpr9_owdut",
    "type": "request",
    "position_x": 22,
    "position_y": 36,
    "options": {
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/campaign",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{\n    \"automation_name\": \"membership_update_approved_investing\",\n    \"user_ids\": {{user_ids.user_ids_investing}}\n}",
      "method": "POST"
    },
    "resolve": null,
    "reject": null,
    "flow": "0bb93aa4-2de7-4219-aae6-6f9e6e26ba0a",
    "_syncId": "b1deaa64-a9c2-4f06-a598-7ec6c7be45ee"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_o180l",
    "type": "request",
    "position_x": 40,
    "position_y": 19,
    "options": {
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/campaign",
      "method": "POST",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{\n    \"automation_name\": \"invoice_update_paid\",\n    \"user_ids\": {{user_ids.user_ids}}\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "28c0f3c7-d900-4f6d-be60-da5a803be396",
    "_syncId": "91166d55-508c-40f2-ac22-405e25ec647b"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_q45vs",
    "type": "request",
    "position_x": 3,
    "position_y": 33,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/admin_mail",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{{ $last.body }}"
    },
    "resolve": null,
    "reject": null,
    "flow": "610aa314-bd89-461e-b8a0-10d0ad75f2d4",
    "_syncId": "d3b67397-8a80-4eb4-b0e3-1efb24a935b7"
  },
  {
    "name": "Webhook / Anfrage URL",
    "key": "request_u68ix",
    "type": "request",
    "position_x": 8,
    "position_y": 73,
    "options": {
      "method": "POST",
      "url": "{{$env.COLLECTIVO_API_URL}}/api/campaigns/campaign",
      "headers": [
        {
          "header": "Authorization",
          "value": "Bearer {{$env.COLLECTIVO_API_TOKEN}}"
        }
      ],
      "body": "{\n    \"automation_name\": \"{{automation_name.automation_name}}\",\n    \"user_ids\": [\"{{ read_membership.memberships_user }}\"],\n    \"assignment_date_start\": \"{{ read_assignment.shifts_from }}\",\n    \"assignment_date_end\": \"{{ read_assignment.shifts_to }}\",\n    \"shift_time_start\": \"{{ read_shift.shifts_from_time }}\",\n    \"shift_time_end\": \"{{ read_shift.shifts_to_time }}\",\n    \"shift_name\": \"{{ read_shift.shifts_name }}\"\n}"
    },
    "resolve": null,
    "reject": null,
    "flow": "4132f37d-df4d-4d17-ae4f-f048b8a74af5",
    "_syncId": "594dbc33-1c9e-4e63-a503-70bd92f784d3"
  },
  {
    "name": "send_campaign",
    "key": "send_campaign",
    "type": "item-update",
    "position_x": 22,
    "position_y": 54,
    "options": {
      "permissions": "$full",
      "collection": "messages_campaigns",
      "payload": {
        "messages_campaign_status": "pending"
      },
      "key": [
        "{{create_campaign[0]}}"
      ],
      "emitEvents": true
    },
    "resolve": null,
    "reject": null,
    "flow": "28c0f3c7-d900-4f6d-be60-da5a803be396",
    "_syncId": "ba9bdc64-5e33-4cee-8858-bb70e25d5d2c"
  },
  {
    "name": "set_status_to_pending",
    "key": "set_status_to_pending",
    "type": "item-update",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "query": {
        "filter": {
          "_and": [
            {
              "messages_campaign_status": {
                "_eq": "draft"
              }
            },
            {
              "id": {
                "_in": "{{$trigger.body.keys}}"
              }
            }
          ]
        }
      },
      "payload": {
        "messages_campaign_status": "pending"
      },
      "emitEvents": true,
      "permissions": "$full",
      "collection": "messages_campaigns"
    },
    "resolve": null,
    "reject": null,
    "flow": "8b324a75-f005-403d-8197-48accc2d3538",
    "_syncId": "5bbba7d2-4d6a-4969-856b-f83c3347411d"
  },
  {
    "name": "Flow auslösen",
    "key": "trigger_8p2e7",
    "type": "trigger",
    "position_x": 4,
    "position_y": 21,
    "options": {
      "iterationMode": "serial",
      "flow": "f714c75a-e78a-4c80-9b4d-4b39943d6444",
      "payload": "{{ $last }}"
    },
    "resolve": null,
    "reject": null,
    "flow": "093c3c49-f5f8-41e0-bc77-7a6ec9fe7a80",
    "_syncId": "37ed69b5-8376-4ff7-bdc8-c8614fdce196"
  },
  {
    "name": "Flow auslösen",
    "key": "trigger_atody",
    "type": "trigger",
    "position_x": 10,
    "position_y": 22,
    "options": {
      "iterationMode": "parallel",
      "payload": "{{ $trigger.keys }}",
      "flow": "c97d8437-3ee4-49d3-9e95-a1b0b147b9b7"
    },
    "resolve": null,
    "reject": null,
    "flow": "da1d3f39-d1a5-4150-a524-507e048580d5",
    "_syncId": "a4a467a1-ae48-4057-a59e-b35c460ad4f7"
  },
  {
    "name": "Flow auslösen",
    "key": "trigger_f9yog",
    "type": "trigger",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "payload": "{{$last}}",
      "flow": "e67933a7-f0df-41e2-b905-d49a8f2482db"
    },
    "resolve": null,
    "reject": null,
    "flow": "3bfde787-1881-4718-b02f-743d5f1f2a74",
    "_syncId": "bc86b485-dfae-4f74-ac08-47464f98ac03"
  },
  {
    "name": "Flow auslösen",
    "key": "trigger_oo8by",
    "type": "trigger",
    "position_x": 37,
    "position_y": 1,
    "options": {
      "iterationMode": "serial",
      "payload": "{{ $last }}",
      "flow": "6179bf54-3ad8-4def-834d-b0cccf33c0dc"
    },
    "resolve": null,
    "reject": null,
    "flow": "ad8b2f6a-a0ec-4325-ad14-4b678b9acd83",
    "_syncId": "45d99975-c1ae-49e0-b5d3-d96733769b73"
  },
  {
    "name": "Flow auslösen",
    "key": "trigger_wahet",
    "type": "trigger",
    "position_x": 33,
    "position_y": 46,
    "options": {
      "flow": "55cc41e8-4d68-4895-b42e-e5af00a316f4",
      "iterationMode": "serial",
      "payload": "{{ $last.payload }}"
    },
    "resolve": null,
    "reject": null,
    "flow": "c36a2159-395e-4eec-acb7-86cbd1d81d5c",
    "_syncId": "b6fadce2-0240-4c30-9a3d-dfa6b1c453da"
  },
  {
    "name": "updateMembership",
    "key": "updateMembership",
    "type": "item-update",
    "position_x": 19,
    "position_y": 1,
    "options": {
      "collection": "memberships",
      "payload": {
        "memberships_shares": "{{$trigger.payload.memberships_shares}}"
      },
      "emitEvents": true,
      "key": [
        "{{$trigger.key}}"
      ]
    },
    "resolve": null,
    "reject": null,
    "flow": "493c1260-3bb9-47e7-940d-115b8b0f1ccc",
    "_syncId": "cfd6218a-7de5-4c15-9757-597a1312f9a6"
  },
  {
    "name": "User ids",
    "key": "user_ids",
    "type": "exec",
    "position_x": 22,
    "position_y": 19,
    "options": {
      "code": "module.exports = async function(data) {\n\t\n    const user_ids = []\n    let id = undefined\n    \n    for (i in data[\"read_invoices\"]) {\n    \tid = data[\"read_invoices\"][i].payments_recipient_user\n        if (id) {\n            user_ids.push(id)\n        }\n    }\n    \n\treturn { user_ids };\n}"
    },
    "resolve": "91166d55-508c-40f2-ac22-405e25ec647b",
    "reject": null,
    "flow": "28c0f3c7-d900-4f6d-be60-da5a803be396",
    "_syncId": "4bb7b88f-e8cc-4b46-b7ed-a075b3cd334b"
  },
  {
    "name": "user ids",
    "key": "user_ids",
    "type": "exec",
    "position_x": 22,
    "position_y": 22,
    "options": {
      "code": "module.exports = async function(data) {\n\t\n    const user_ids = []\n    let id = undefined\n    for (i in data.$last) {\n    \tuser_ids.push(data.$last[i].wunsch_von.memberships_user)\n    }\n    \n\treturn { user_ids };\n}"
    },
    "resolve": "a9c23e19-5e10-4ad6-90fd-4744f3b2fbb1",
    "reject": null,
    "flow": "c97d8437-3ee4-49d3-9e95-a1b0b147b9b7",
    "_syncId": "501bf9c8-8fa6-47af-ad46-81aca3b727e7"
  }
]
